---
title: "Script pour une base de données"
author: "Paul CRESPIN"
date: "2024-05-30"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
options(max.print = 20)
```

```{r}
setwd("C:/Users/Pol/Desktop/Stage")
load("Base_De_Donnees_Spectres.RData")
```



# Création de la base vide

Base_De_Donnees_Spectro_et_Spectres <- list(Annee2022 = list(), Annee2023 = list(), Spectro = list())
Base_De_Donnees_Spectro <- list()
```{r}
Base_De_Donnees_Spectres <- list(Annee2022 = list(), Annee2023 = list())
```

# 2022

```{r}
# Labo_rajout <- "AE Dijon Circuit A"
# Labo_rajout <- "AE Dijon Circuit A retour Guadeloupe"
# Labo_rajout <- "AE Dijon Circuit B retour"
Labo_rajout <- "AE Dijon Circuit C retour"
# Labo_rajout <- "AE Dijon"
Labo <- Labo_rajout
Spectro_rajout <- "FOSS 2500"
# Spectro_rajout <- "FOSS 6500"
Spectro <- Spectro_rajout

DateFormat <- "%Y-%m-%d"

Circuit <- "C"
Nb_Rep <- 1
Type_Rep <- 1
Resolution <- 0.5
# Resolution <- 2
Unite_X <- "nm"
Abs_ou_Ref <- "Abs"
Date <- NA
Heure <- NA
Temperature <- NA
Hygrometrie <- NA

# Pour un tableau XLSX, si la première ligne et colonne sont vides, faire comme si elles n'existaient pas.

colonne_exclue <- c(1) # Tableau CSV uniquement
colonne_date <- 2 # NA si pas de date/heure
colonne_heure <- 3
ligne_debut <- 1

Annee = "Annee2022"

debut_ech <- 1
fin_ech <- 184

except_ech <- c(126, 127, 128, 129, 131, 132)
```

## Rajout d'un labo en 2022

```{r}
library(rlist)

if (!(Labo_rajout %in% names(Base_De_Donnees_Spectres[[Annee]][["BGE7"]]))) {
  for (i in (debut_ech:fin_ech)[- except_ech]) {
    Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]] <- list.append(Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]], New_lab = list())
    names(Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]])[length(names(Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]]))] <- Labo_rajout
  }
}
```

## Rajout d'un Spectro en 2022

```{r}
if (!(Spectro_rajout %in% names(Base_De_Donnees_Spectres[[Annee]][["BGE7"]][[Labo]]))) {
  for (i in (debut_ech:fin_ech)[- except_ech]) {
    Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]] <- list.append(Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]], New_spectro = list(NULL))
    names(Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]])[length(Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]])] <- Spectro_rajout
    Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro_rajout]] <- list(Mesure_1 = list(Meta = data.frame(Circuit = Circuit, Nb_Rep = Nb_Rep, Type_Rep = Type_Rep, Resolution = Resolution, Unite_X = Unite_X, Abs_ou_Ref = Abs_ou_Ref, Date = Date, Heure = Heure, Temperature = Temperature, Hygrometrie = Hygrometrie), Spectre = NA))
  }
}
```



## Données non répétées 2022 (Fichier unique)

```{r}
except_ech <- c(19, 24, 118, 168, 126, 127, 128, 129, 131, 132)

debut_fichier <- "BGE22-"
fin_fichier <- "_C_fibre_optique.0.txt"

chemin <- "./circuit C/C-BIOGECO-Bordeaux (1)/C-BIOGECO-Bordeaux/Mesures_fibre_format_TXT/"

Spectro = Spectro_rajout

for (i in (debut_ech:fin_ech)[- except_ech]) {
  tryCatch(
    {
      if (i < 10) {
        nom_actuel <- paste0(debut_fichier, "00", i, fin_fichier) #paste0 plutôt que paste car il a un séparateur vide de base.
      } else if (i < 100) {
        nom_actuel <- paste0(debut_fichier, "0", i, fin_fichier)
      } else {
        nom_actuel <- paste0(debut_fichier, i, fin_fichier)
      }
      Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][["Mesure_1"]][["Spectre"]] <- read.csv(paste(chemin, nom_actuel, sep = ""), header = FALSE)
    },
    warning = function(w) {
      print(i)
    }
  )
}

# for (i in (debut_ech:fin_ech)[- except_ech]) {
#   plot(Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]]$BIOGECO_Bordeaux$MPA1$Mesure_1$Spectre)
# }
```

## Données répétées 2022 (Fichier unique)

```{r}

fin <- "_C_fibre_optique."
fin_bis <- "_C_Coupelle_rotative_répétition_machine."
nb_rep <- 5

for (i in (except_ech[1:4])) {
  tryCatch(
    {
      
      fin_fichier <- paste0(fin, 0, ".txt")
      if (i < 10) {
        nom_actuel <- paste0(debut_fichier, "00", i, fin_fichier) #paste0 plutôt que paste car il a un séparateur vide de base.
      } else if (i < 100) {
        nom_actuel <- paste0(debut_fichier, "0", i, fin_fichier)
      } else {
        nom_actuel <- paste0(debut_fichier, i, fin_fichier)
      }
      Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][[paste0("Mesure_", 1)]][["Spectre"]] <- read.csv(paste(chemin, nom_actuel, sep = ""), header = FALSE)
      Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][[paste0("Mesure_", 1)]][["Meta"]][["Type_Rep"]] <- 1
      
      for (j in 1:(nb_rep - 1)) {
        fin_fichier <- paste0(fin, j, ".txt")
      if (i < 10) {
          nom_actuel <- paste0(debut_fichier, "00", i, fin_fichier) #paste0 plutôt que paste car il a un séparateur vide de base.
        } else if (i < 100) {
          nom_actuel <- paste0(debut_fichier, "0", i, fin_fichier)
        } else {
          nom_actuel <- paste0(debut_fichier, i, fin_fichier)
        }
        Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][[paste0("Mesure_", j + 1)]][["Meta"]] <- data.frame(Circuit = Circuit, Nb_Rep = j + 1, Type_Rep = 1, Resolution = Resolution, Unite_X = Unite_X, Abs_ou_Ref = Abs_ou_Ref, Date = Date, Heure = Heure, Temperature = Temperature, Hygrometrie = Hygrometrie)
        Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][[paste0("Mesure_", j + 1)]][["Spectre"]] <- read.csv(paste(chemin, nom_actuel, sep = ""), header = FALSE)
      }
      
      # for (k in 0:4) {
      #   fin_fichier <- paste0(fin_bis, k, ".txt")
      #   if (i < 10) {
      #     nom_actuel <- paste0(debut_fichier, "00", i, fin_fichier) #paste0 plutôt que paste car il a un separateur vide de base.
      #   } else if (i < 100) {
      #     nom_actuel <- paste0(debut_fichier, "0", i, fin_fichier)
      #   } else {
      #     nom_actuel <- paste0(debut_fichier, i, fin_fichier)
      #   }
      #   Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][[paste0("Mesure_", k + 5)]][["Meta"]] <- data.frame(Circuit = Circuit, Nb_Rep = k + 5, Type_Rep = 2, Resolution = Resolution, Unite_X = Unite_X, Abs_ou_Ref = Abs_ou_Ref, Date = Date, Heure = Heure, Temperature = Temperature, Hygrometrie = Hygrometrie)
      #   Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][[paste0("Mesure_", k + 5)]][["Spectre"]] <- read.csv(paste(chemin, nom_actuel, sep = ""), header = FALSE)
      # }
    },
    warning = function(w) {
      print(i, j)
    }
  )
}
```

```{r}
save(Base_De_Donnees_Spectres, file = "Base_De_Donnees_Spectres.RData")
```

## Données non répétés 2022 (Tableau xlsx)

```{r}
chemin_fichier <- "Data (ancien)/Circuit C/C-AE-Dijon/DIJON Inspir C retour a Dijon depuis Montpellier.xlsx"
# chemin_fichier <- "Data (ancien)/Circuit B/B-AE-Dijon/DIJON Inspir B retour a Dijon depuis Gif.xlsx"
# chemin_fichier <- "Data (ancien)/Circuit A/A-AE-Dijon/circuits lots globaux/DIJON Inspir A retour a Dijon depuis Guadeloupe.xlsx"
# chemin_fichier <- "Data (ancien)/Circuit A/A-AE-Dijon/circuits lots globaux/DIJON Inspir A (Orléans)-Dijon-(Antilles).xlsx"
# chemin_fichier <- "Data (ancien)/Circuit A/A-AE-Dijon/circuits lots globaux/DIJON Inspir export.xlsx"

feuille <- "ds2500"
# feuille <- "6500"
debut <- "BGE22-"
# fin <- "A"
# fin <- "B"
fin <- "C"
# fin <- ""

Spectro <- Spectro_rajout

library(readxl)
tableau <- read_excel(chemin_fichier, sheet = feuille, col_names = TRUE)

colonne_premiere_mesure <- 6
colonne_ech <- 1

# except_ech <- c(19, 24, 118, 168, 62, 130, 148, 175, 126, 127, 128, 129, 131, 132)
except_ech <- c(19, 24, 118, 168, 126, 127, 128, 129, 131, 132)
# except_ech <- c(126, 127, 128, 129, 131, 132)

# for (i in c(62, 130, 148, 175)) {
for (i in (debut_ech:fin_ech)[- except_ech]) {
  if (!is.na(colonne_date) && is.na(colonne_heure)) {
    tryCatch(
      {
        if (i < 10) {
          nom_actuel <- paste0(debut, "00", i, fin) #paste0 plutôt que paste car il a un séparateur vide de base.
        } else if (i < 100) {
          nom_actuel <- paste0(debut, "0", i, fin)
        } else {
          nom_actuel <- paste0(debut, i, fin)
        }
        y = which(nom_actuel == tableau[, colonne_ech])
      
        # résolution pas en nom de colonne
        # Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][["Mesure_1"]][["Spectre"]] <- data.frame(V1 = t(t(as.numeric(tableau[ligne_debut - 1, colonne_premiere_mesure:length(tableau[ligne_debut - 1, ])]))), V2 = t(t(as.numeric(tableau[y, colonne_premiere_mesure:length(tableau[y, ])]))))
      
        # résolution en nom de colonne
        Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][["Mesure_1"]][["Spectre"]] <- data.frame(V1 = t(t(as.numeric(colnames(tableau[y, colonne_premiere_mesure:length(tableau[y, ])])))), V2 = t(t(as.numeric(tableau[y, colonne_premiere_mesure:length(tableau[y, ])]))))
      
      Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][["Mesure_1"]][["Meta"]][["Date"]] <- format(tableau[[colonne_date]][[y]], format = "%D")
      
      Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][["Mesure_1"]][["Meta"]][["Heure"]] <- format(tableau[[colonne_date]][[y]], format = "%H:%M:%S")
      },
      warning = function(w) {
        print(i)
      }
    )
  } else {
    tryCatch(
      {
        if (i < 10) {
          nom_actuel <- paste0(debut, "00", i, fin) #paste0 plutôt que paste car il a un séparateur vide de base.
        } else if (i < 100) {
          nom_actuel <- paste0(debut, "0", i, fin)
        } else {
          nom_actuel <- paste0(debut, i, fin)
        }
        y = which(nom_actuel == tableau[, colonne_ech])
      
        # résolution pas en nom de colonne
        # Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][["Mesure_1"]][["Spectre"]] <- data.frame(V1 = t(t(as.numeric(tableau[ligne_debut - 1, colonne_premiere_mesure:length(tableau[ligne_debut - 1, ])]))), V2 = t(t(as.numeric(tableau[y, colonne_premiere_mesure:length(tableau[y, ])]))))
      
        # résolution en nom de colonne
        Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][["Mesure_1"]][["Spectre"]] <- data.frame(V1 = t(t(as.numeric(colnames(tableau[y, colonne_premiere_mesure:length(tableau[y, ])])))), V2 = t(t(as.numeric(tableau[y, colonne_premiere_mesure:length(tableau[y, ])]))))
        
        
        Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][["Mesure_1"]][["Meta"]][["Date"]] <- ifelse(is.na(colonne_date), Date, format(tableau[[colonne_date]][[y]], format = "%d/%m/%Y"))
      
        Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][["Mesure_1"]][["Meta"]][["Heure"]] <- ifelse(is.na(colonne_heure), Heure, format(tableau[[colonne_heure]][[y]], format = "%H:%M:%S"))
        
      },
      warning = function(w) {
        print(i)
      }
    )
  }
}
```

## Données répétés 2022 (Tableau xlsx)

```{r}
chemin_fichier <- "Data (ancien)/Circuit A/A-AE-Dijon/circuits lots globaux/DIJON Inspir export.xlsx"
feuille <- "6500"
debut <- "BGE22-"
fin <- "C"

l <- 0 # 0 par défaut, décalage de toutes les mesures à répéter si on en a déjà précédemment (dans non répétés) (Ex: PEGASE St Gilles)

nb_rep <- 15
k <- 0 # 0 par défaut, décalage pour changer le type de répétition
typ_rep <- 2

colonne_premiere_mesure <- 5
colonne_ech <- 1

Spectro <- Spectro_rajout

library(readxl)
# tableau <- read_excel(chemin_fichier, sheet = feuille, col_names = TRUE)

# except_ech <- c(19, 24, 118, 168, 126, 127, 128, 129, 131, 132)
except_ech <- c(126, 127, 128, 129, 131, 132)

# for (i in (debut_ech:fin_ech)[- except_ech]) {
for (i in c(19, 24, 118, 168)) {
# for (i in c(19, 24, 118, 168, 62, 130, 148, 175)) {
  if (!is.na(colonne_date) && is.na(colonne_heure)) {
    tryCatch(
      {
        if (i < 10) {
          nom_actuel <- paste0(debut, "00", i, fin) #paste0 plutôt que paste car il a un séparateur vide de base.
        } else if (i < 100) {
          nom_actuel <- paste0(debut, "0", i, fin)
        } else {
          nom_actuel <- paste0(debut, i, fin)
        }
        y = which(nom_actuel == tableau[, colonne_ech])
      
        Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][[paste0("Mesure_", (1 + l + k))]][["Meta"]] <- data.frame(Circuit = Circuit, Nb_Rep = 1, Type_Rep = typ_rep, Resolution = Resolution, Unite_X = Unite_X, Abs_ou_Ref = Abs_ou_Ref, Date = format(tableau[[colonne_date]][y[1 + k]], format = "%D"), Heure = format(tableau[[colonne_date]][y[1 + k]], format = "%H:%M:%S"), Temperature = Temperature, Hygrometrie = Hygrometrie)
      
        # résolution en nom de colonne
        #Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][[paste0("Mesure_", (1 + l + k))]][["Spectre"]] <- data.frame(V1 = t(t(as.numeric(colnames(tableau[y[1 + k], colonne_premiere_mesure:length(tableau[y[1 + k], ])])))), V2 = t(t(as.numeric(tableau[y[1 + k], colonne_premiere_mesure:length(tableau[y[1 + k], ])]))))
      
        # résolution pas en nom de colonne
        Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][[paste0("Mesure_", (1 + l + k))]][["Spectre"]] <- data.frame(V1 = t(t(as.numeric(tableau[ligne_debut - 1, colonne_premiere_mesure:length(tableau[ligne_debut - 1, ])]))), V2 = t(t(as.numeric(tableau[y[1 + k], colonne_premiere_mesure:length(tableau[y[1 + k], ])])))) 
      
        for (j in (2 + k):(nb_rep + k)) {
          if (i < 10) {
            nom_actuel <- paste0(debut, "00", i, fin) #paste0 plutôt que paste car il a un séparateur vide de base.
          } else if (i < 100) {
            nom_actuel <- paste0(debut, "0", i, fin)
          } else {
            nom_actuel <- paste0(debut, i, fin)
          }
          
          Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][[paste0("Mesure_", (j + l))]][["Meta"]] <- data.frame(Circuit = Circuit, Nb_Rep = (j - k), Type_Rep = typ_rep, Resolution = Resolution, Unite_X = Unite_X, Abs_ou_Ref = Abs_ou_Ref, Date = format(tableau$Horodatage[y[j]], format = "%D"), Heure = format(tableau$Horodatage[y[j]], format = "%H:%M:%S"), Temperature = Temperature, Hygrometrie = Hygrometrie)
          
          # résolution en nom de colonne
          # Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][[paste0("Mesure_", j + l)]][["Spectre"]] <- data.frame(V1 = t(t(as.numeric(colnames(tableau[y[j], colonne_premiere_mesure:length(tableau[y[j], ])])))), V2 = t(t(as.numeric(tableau[y[j], colonne_premiere_mesure:length(tableau[y[j], ])]))))
          
          # résolution pas en nom de colonne
          Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][[paste0("Mesure_", j + l)]][["Spectre"]] <- data.frame(V1 = t(t(as.numeric(tableau[ligne_debut - 1, colonne_premiere_mesure:length(tableau[ligne_debut - 1, ])]))), V2 = t(t(as.numeric(tableau[y[j], colonne_premiere_mesure:length(tableau[y[j], ])]))))
      }
    },
    warning = function(w) {
      print(i)
      print(j)
      print(w)
    },
    error = function(e) {
      print(i)
      print(j)
      print(e)
    }
  )
  
  } else {
    
    tryCatch(
      {
        if (i < 10) {
          nom_actuel <- paste0(debut, "00", i, fin) #paste0 plutôt que paste car il a un séparateur vide de base.
        } else if (i < 100) {
          nom_actuel <- paste0(debut, "0", i, fin)
        } else {
          nom_actuel <- paste0(debut, i, fin)
        }
        y = which(nom_actuel == tableau[, colonne_ech])
      
        Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][[paste0("Mesure_", (1 + l + k))]][["Meta"]] <- data.frame(Circuit = Circuit, Nb_Rep = 1, Type_Rep = typ_rep, Resolution = Resolution, Unite_X = Unite_X, Abs_ou_Ref = Abs_ou_Ref, Date = ifelse(is.na(colonne_date), Date, format(tableau[[colonne_date]][[y[1 + k]]], format = "%d/%m/%Y")), Heure = ifelse(is.na(colonne_heure), Heure, format(tableau[[colonne_heure]][[y[1 + k]]], format = "%H:%M:%S")), Temperature = Temperature, Hygrometrie = Hygrometrie)
        
        # Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][[paste0("Mesure_", (1 + l + k))]][["Meta"]] <- data.frame(Circuit = Circuit, Nb_Rep = 1, Type_Rep = typ_rep, Resolution = Resolution, Unite_X = Unite_X, Abs_ou_Ref = Abs_ou_Ref, Date = Date, Heure = ifelse(is.na(colonne_heure), Heure, tableau[[colonne_heure]][[y[1 + k]]]), Temperature = Temperature, Hygrometrie = Hygrometrie)
      
        # résolution en nom de colonne
        Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][[paste0("Mesure_", (1 + l + k))]][["Spectre"]] <- data.frame(V1 = t(t(as.numeric(colnames(tableau[y[1 + k], colonne_premiere_mesure:length(tableau[y[1 + k], ])])))), V2 = t(t(as.numeric(tableau[y[1 + k], colonne_premiere_mesure:length(tableau[y[1 + k], ])]))))
      
        # résolution pas en nom de colonne
        # Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][[paste0("Mesure_", (1 + l + k))]][["Spectre"]] <- data.frame(V1 = t(t(as.numeric(tableau[ligne_debut - 1, colonne_premiere_mesure:length(tableau[ligne_debut - 1, ])]))), V2 = t(t(as.numeric(tableau[y[1 + k], colonne_premiere_mesure:length(tableau[y[1 + k], ])])))) 
      
        for (j in (2 + k):(nb_rep + k)) {
          if (i < 10) {
            nom_actuel <- paste0(debut, "00", i, fin) #paste0 plutôt que paste car il a un séparateur vide de base.
          } else if (i < 100) {
            nom_actuel <- paste0(debut, "0", i, fin)
          } else {
            nom_actuel <- paste0(debut, i, fin)
          }
          
          Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][[paste0("Mesure_", (j + l))]][["Meta"]] <- data.frame(Circuit = Circuit, Nb_Rep = (j - k), Type_Rep = typ_rep, Resolution = Resolution, Unite_X = Unite_X, Abs_ou_Ref = Abs_ou_Ref, Date = ifelse(is.na(colonne_date), Date, format(tableau[[colonne_date]][[y[1 + k]]], format = "%d/%m/%Y")), Heure = ifelse(is.na(colonne_heure), Heure, format(tableau[[colonne_heure]][[y[1 + k]]], format = "%H:%M:%S")), Temperature = Temperature, Hygrometrie = Hygrometrie)
          
          # Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][[paste0("Mesure_", (j + l))]][["Meta"]] <- data.frame(Circuit = Circuit, Nb_Rep = (j - k), Type_Rep = typ_rep, Resolution = Resolution, Unite_X = Unite_X, Abs_ou_Ref = Abs_ou_Ref, Date = Date, Heure = ifelse(is.na(colonne_heure), Heure, tableau[[colonne_heure]][[y[1 + k]]]), Temperature = Temperature, Hygrometrie = Hygrometrie)
          
          # résolution en nom de colonne
          Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][[paste0("Mesure_", j + l)]][["Spectre"]] <- data.frame(V1 = t(t(as.numeric(colnames(tableau[y[j], colonne_premiere_mesure:length(tableau[y[j], ])])))), V2 = t(t(as.numeric(tableau[y[j], colonne_premiere_mesure:length(tableau[y[j], ])]))))
          
          # résolution pas en nom de colonne
          # Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][[paste0("Mesure_", j + l)]][["Spectre"]] <- data.frame(V1 = t(t(as.numeric(tableau[ligne_debut - 1, colonne_premiere_mesure:length(tableau[ligne_debut - 1, ])]))), V2 = t(t(as.numeric(tableau[y[j], colonne_premiere_mesure:length(tableau[y[j], ])]))))
      }
    },
    warning = function(w) {
      print(i)
      print(j)
      print(w)
    },
    error = function(e) {
      print(i)
      print(j)
      print(e)
    }
  )
  }
}
```

## Données non répétés 2022 (Tableau csv)

```{r}
chemin_fichier <- "Data/Circuit C/C-BIOGECO-Bordeaux/MPA1_Coupelle.csv"
sep <- ";"
debut <- "BGE22-"
fin <- ""

tableau <- read.csv(chemin_fichier, header = FALSE, sep = sep)

except_ech <- c(19, 24, 118, 168, 126, 127, 128, 129, 131, 132)
# except_ech <- c(126, 127, 128, 129, 131, 132)

suppressWarnings(unite <- as.vector(unlist(lapply(tableau, `[[`, ligne_debut), use.names = FALSE), 'numeric')[- colonne_exclue])

for (i in (debut_ech:fin_ech)[- except_ech]) {
  tryCatch(
    {
      if (i < 10) {
        nom_actuel <- paste0(debut, "00", i, fin) #paste0 plutôt que paste car il a un séparateur vide de base.
      } else if (i < 100) {
        nom_actuel <- paste0(debut, "0", i, fin)
      } else {
        nom_actuel <- paste0(debut, i, fin)
      }
      y = which(nom_actuel == tableau[, 1])
      
      Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][["Mesure_1"]][["Spectre"]] <- data.frame(V1 = unite, V2 = as.vector(unlist(lapply(tableau, `[[`, y[1]), use.names = FALSE)[- colonne_exclue], 'numeric'))
      
      if (!is.na(colonne_date)) {
        Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][["Mesure_1"]][["Meta"]][["Date"]] <- tableau[[colonne_date]][[y[1]]]
      }
      
      if (!is.na(colonne_heure)) {
        Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][["Mesure_1"]][["Meta"]][["Heure"]] <- tableau[[colonne_heure]][[y[1]]]
      }
    },
    warning = function(w) {
      print(i)
      print(w)
    },
    error = function(e) {
      print(i)
      print(e)
    }
  )
}

```

## Données répétés 2022 (Tableau csv)

```{r}
chemin_fichier <- "Data/Circuit C/C-BIOGECO-Bordeaux/MPA1_Coupelle.csv"
sep <- ";"
debut <- "BGE22-"
fin <- ""


colonne_exclue <- c(1, 2, 3, 4, 5)
colonne_date <- 3
colonne_heure <- 4
ligne_debut <- 1

l <- 0 # 0 par défaut, décalage de toutes les mesures à répéter si on en a déjà précedemment, dans un autre tableau (dans non répétés) (Ex: PEGASE St Gilles)

nb_rep <- 5
k <- 1 # 0 par défaut, décalage pour changer le type de répétition
typ_rep <- 2


# tableau <- read.csv(chemin_fichier, header = FALSE, sep = sep)

# except_ech <- c(19, 24, 118, 168, 126, 127, 128, 129, 131, 132)
except_ech <- c(126, 127, 128, 129, 131, 132)

suppressWarnings(unite <- as.vector(unlist(lapply(tableau, `[[`, ligne_debut), use.names = FALSE), 'numeric')[- colonne_exclue])

Spectro <- Spectro_rajout

# for (i in (debut_ech:fin_ech)[- except_ech]) { # S'il toutes les données ont des répétitions
for (i in c(19, 24, 118, 168)) {
  tryCatch(
    {
      if (i < 10) {
        nom_actuel <- paste0(debut, "00", i, fin) #paste0 plutôt que paste car il a un séparateur vide de base.
      } else if (i < 100) {
        nom_actuel <- paste0(debut, "0", i, fin)
      } else {
        nom_actuel <- paste0(debut, i, fin)
      }
      y = which(nom_actuel == tableau[, 1])
      
      Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][[paste0("Mesure_", (1 + l + k))]][["Meta"]] <- data.frame(Circuit = Circuit, Nb_Rep = 1, Type_Rep = typ_rep, Resolution = Resolution, Unite_X = Unite_X, Abs_ou_Ref = Abs_ou_Ref, Date = ifelse(is.na(colonne_date), Date, tableau[[colonne_date]][[y[1 + k]]]), Heure = ifelse(is.na(colonne_heure), Heure, tableau[[colonne_heure]][[y[1 + k]]]), Temperature = Temperature, Hygrometrie = Hygrometrie)
      
      Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][[paste0("Mesure_", (1 + l + k))]][["Spectre"]] <- data.frame(V1 = unite, V2 = as.vector(unlist(lapply(tableau, `[[`, y[1 + k]), use.names = FALSE)[- colonne_exclue], 'numeric'))
      
      if (nb_rep != 1){
        for (j in (2 + k):(nb_rep + k)) {
          Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][[paste0("Mesure_", (j + l))]][["Meta"]] <- data.frame(Circuit = Circuit, Nb_Rep = (j - k), Type_Rep = typ_rep, Resolution = Resolution, Unite_X = Unite_X, Abs_ou_Ref = Abs_ou_Ref, Date = ifelse(is.na(colonne_date), Date, tableau[[colonne_date]][[y[j]]]), Heure = ifelse(is.na(colonne_heure), Heure, tableau[[colonne_heure]][[y[j]]]), Temperature = Temperature, Hygrometrie = Hygrometrie)
        
        Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][[paste0("Mesure_", j + l)]][["Spectre"]] <- data.frame(V1 = unite, V2 = as.vector(unlist(lapply(tableau, `[[`, y[j]), use.names = FALSE)[- colonne_exclue], 'numeric'))
        }
      }
      
    },
    warning = function(w) {
      print(i)
      print(j)
      print(w)
    },
    error = function(e) {
      print(i)
      print(j)
      print(e)
    }
  )
}
```


## Données non répétées 2022 (Fichier unique dans un tableau)

```{r}
except_ech <- c(19, 24, 118, 168, 126, 127, 128, 129, 131, 132)

chemin <- "Data/Circuit B/B-IJPB-Versailles/INTERLABO24_240605/INTERLABO24_240605/IJPB_Versailles_MODELE 2etuve.xlsx"

debut <- "BGE22-"
fin <- "_"

colonne_ech <- 2
colonne_fichier <- 7

Spectro = Spectro_rajout

library(readxl)
tableau <- read_excel(chemin, sheet = "DS2500", col_names = FALSE)

for (i in (debut_ech:fin_ech)[- except_ech]) {
  tryCatch(
    {
      if (i < 10) {
        nom_actuel <- paste0(debut, "00", i, fin) #paste0 plutôt que paste car il a un séparateur vide de base.
      } else if (i < 100) {
        nom_actuel <- paste0(debut, "0", i, fin)
      } else {
        nom_actuel <- paste0(debut, i, fin)
      }
      y = which(nom_actuel == tableau[, colonne_ech])
      
      fichier <- read_csv(paste0("Data/Circuit B/B-IJPB-Versailles/INTERLABO24_240605/INTERLABO24_240605/", tableau[y, colonne_fichier]), show_col_types = FALSE)
      
      Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][["Mesure_1"]][["Meta"]][["Date"]] <- substr(as.character(fichier[5, ]), 12, nchar(as.character(fichier[5, ])))
      Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][["Mesure_1"]][["Meta"]][["Heure"]] <- substr(as.character(fichier[6, ]), 8, nchar(as.character(fichier[6, ])))
        
      unite <- c(as.numeric(substr(as.character(fichier[45, ]), 1, 8)))
      for (j in 1:259) {
        prochain <- as.numeric(substr(as.character(fichier[j + 45, ]), 1, 8))
        dif <- (prochain - unite[(j - 1) * 6 + 1]) / 6
        unite <- c(unite, prochain - 5 * dif, prochain - 4 * dif, prochain - 3 * dif, prochain - 2 * dif, prochain - dif, prochain)
      }
      unite <- c(unite, prochain + (as.numeric(substr(as.character(fichier[35, ]), 8, nchar(as.character(fichier[35, ])))) - prochain) / 2, as.numeric(substr(as.character(fichier[35, ]), 8, nchar(as.character(fichier[35, ])))))
        
      spectre <- c(as.numeric(substr(as.character(fichier[45, ]), 9, 18)) / 10^9, as.numeric(substr(as.character(fichier[45, ]), 19, 28)) / 10^9, as.numeric(substr(as.character(fichier[45, ]), 29, 38)) / 10^9, as.numeric(substr(as.character(fichier[45, ]), 39, 48)) / 10^9, as.numeric(substr(as.character(fichier[45, ]), 49, 58)) / 10^9, as.numeric(substr(as.character(fichier[45, ]), 59, 68)) / 10^9)
      for (k in 1:258) {
          spectre <- c(spectre, as.numeric(substr(as.character(fichier[k + 45, ]), 9, 18)) / 10^9, as.numeric(substr(as.character(fichier[k + 45, ]), 19, 28)) / 10^9, as.numeric(substr(as.character(fichier[k + 45, ]), 29, 38)) / 10^9, as.numeric(substr(as.character(fichier[k + 45, ]), 39, 48)) / 10^9, as.numeric(substr(as.character(fichier[k + 45, ]), 49, 58)) / 10^9, as.numeric(substr(as.character(fichier[k + 45, ]), 59, 68)) / 10^9)
      }
      spectre <- c(spectre, as.numeric(substr(as.character(fichier[304, ]), 9, 18)) / 10^9, as.numeric(substr(as.character(fichier[304, ]), 19, 28)) / 10^9, as.numeric(substr(as.character(fichier[304, ]), 29, 38)) / 10^9)
      
      Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][["Mesure_1"]][["Spectre"]] <- data.frame(V1 = unite, V2 = spectre)
        
    },
    warning = function(w) {
      print(i)
    }
  )
}
```

## Données répétées 2022 (Fichier unique dans un tableau)

```{r}
l <- 0 # 0 par défaut, décalage de toutes les mesures à répéter si on en a déjà précédemment (dans non répétés) (Ex: PEGASE St Gilles)

nb_rep <- 2
k <- 5 # 0 par défaut, décalage pour changer le type de répétition
typ_rep <- 3

for (i in c(19, 24, 118, 168)) {
  tryCatch(
    {
      if (i < 10) {
        nom_actuel <- paste0(debut, "00", i, fin) #paste0 plutôt que paste car il a un séparateur vide de base.
      } else if (i < 100) {
        nom_actuel <- paste0(debut, "0", i, fin)
      } else {
        nom_actuel <- paste0(debut, i, fin)
      }
      y = which(nom_actuel == tableau[, colonne_ech])
      
      fichier <- read_csv(paste0("Data/Circuit B/B-IJPB-Versailles/INTERLABO24_240605/INTERLABO24_240605/", tableau[y[1], colonne_fichier]), show_col_types = FALSE)
      
      Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][[paste0("Mesure_", (1 + l + k))]][["Meta"]] <- data.frame(Circuit = Circuit, Nb_Rep = 1, Type_Rep = typ_rep, Resolution = Resolution, Unite_X = Unite_X, Abs_ou_Ref = Abs_ou_Ref, Date = substr(as.character(fichier[5, ]), 12, nchar(as.character(fichier[5, ]))), Heure = substr(as.character(fichier[6, ]), 8, nchar(as.character(fichier[6, ]))), Temperature = Temperature, Hygrometrie = Hygrometrie)
        
      unite <- c(as.numeric(substr(as.character(fichier[45, ]), 1, 8)))
      
      for (q in 1:259) {
        prochain <- as.numeric(substr(as.character(fichier[q + 45, ]), 1, 8))
        dif <- (prochain - unite[(q - 1) * 6 + 1]) / 6
        unite <- c(unite, prochain - 5 * dif, prochain - 4 * dif, prochain - 3 * dif, prochain - 2 * dif, prochain - dif, prochain)
      }
      unite <- c(unite, prochain + (as.numeric(substr(as.character(fichier[35, ]), 8, nchar(as.character(fichier[35, ])))) - prochain) / 2, as.numeric(substr(as.character(fichier[35, ]), 8, nchar(as.character(fichier[35, ])))))
        
      spectre <- c(as.numeric(substr(as.character(fichier[45, ]), 9, 18)) / 10^9, as.numeric(substr(as.character(fichier[45, ]), 19, 28)) / 10^9, as.numeric(substr(as.character(fichier[45, ]), 29, 38)) / 10^9, as.numeric(substr(as.character(fichier[45, ]), 39, 48)) / 10^9, as.numeric(substr(as.character(fichier[45, ]), 49, 58)) / 10^9, as.numeric(substr(as.character(fichier[45, ]), 59, 68)) / 10^9)
      
      for (f in 1:258) {
        spectre <- c(spectre, as.numeric(substr(as.character(fichier[f + 45, ]), 9, 18)) / 10^9, as.numeric(substr(as.character(fichier[f + 45, ]), 19, 28)) / 10^9, as.numeric(substr(as.character(fichier[f + 45, ]), 29, 38)) / 10^9, as.numeric(substr(as.character(fichier[f + 45, ]), 39, 48)) / 10^9, as.numeric(substr(as.character(fichier[f + 45, ]), 49, 58)) / 10^9, as.numeric(substr(as.character(fichier[f + 45, ]), 59, 68)) / 10^9)
      }
      spectre <- c(spectre, as.numeric(substr(as.character(fichier[304, ]), 9, 18)) / 10^9, as.numeric(substr(as.character(fichier[304, ]), 19, 28)) / 10^9, as.numeric(substr(as.character(fichier[304, ]), 29, 38)) / 10^9)
      
      Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][[paste0("Mesure_", (1 + l + k))]][["Spectre"]] <- data.frame(V1 = unite, V2 = spectre)
      
      for (j in (2 + k):(nb_rep + k)) {
        
        fichier <- read_csv(paste0("Data/Circuit B/B-IJPB-Versailles/INTERLABO24_240605/INTERLABO24_240605/", tableau[y[j], colonne_fichier]), show_col_types = FALSE)
        
        Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][[paste0("Mesure_", (j + l))]][["Meta"]] <- data.frame(Circuit = Circuit, Nb_Rep = (j - k), Type_Rep = typ_rep, Resolution = Resolution, Unite_X = Unite_X, Abs_ou_Ref = Abs_ou_Ref, Date = substr(as.character(fichier[5, ]), 12, nchar(as.character(fichier[5, ]))), Heure = substr(as.character(fichier[6, ]), 8, nchar(as.character(fichier[6, ]))), Temperature = Temperature, Hygrometrie = Hygrometrie)
      
        unite <- c(as.numeric(substr(as.character(fichier[45, ]), 1, 8)))
        
        for (u in 1:259) {
          prochain <- as.numeric(substr(as.character(fichier[u + 45, ]), 1, 8))
          dif <- (prochain - unite[(u - 1) * 6 + 1]) / 6
          unite <- c(unite, prochain - 5 * dif, prochain - 4 * dif, prochain - 3 * dif, prochain - 2 * dif, prochain - dif, prochain)
        }
        unite <- c(unite, prochain + (as.numeric(substr(as.character(fichier[35, ]), 8, nchar(as.character(fichier[35, ])))) - prochain) / 2, as.numeric(substr(as.character(fichier[35, ]), 8, nchar(as.character(fichier[35, ])))))
        
        spectre <- c(as.numeric(substr(as.character(fichier[45, ]), 9, 18)) / 10^9, as.numeric(substr(as.character(fichier[45, ]), 19, 28)) / 10^9, as.numeric(substr(as.character(fichier[45, ]), 29, 38)) / 10^9, as.numeric(substr(as.character(fichier[45, ]), 39, 48)) / 10^9, as.numeric(substr(as.character(fichier[45, ]), 49, 58)) / 10^9, as.numeric(substr(as.character(fichier[45, ]), 59, 68)) / 10^9)
        
        for (o in 1:258) {
          spectre <- c(spectre, as.numeric(substr(as.character(fichier[o + 45, ]), 9, 18)) / 10^9, as.numeric(substr(as.character(fichier[o + 45, ]), 19, 28)) / 10^9, as.numeric(substr(as.character(fichier[o + 45, ]), 29, 38)) / 10^9, as.numeric(substr(as.character(fichier[o + 45, ]), 39, 48)) / 10^9, as.numeric(substr(as.character(fichier[o + 45, ]), 49, 58)) / 10^9, as.numeric(substr(as.character(fichier[o + 45, ]), 59, 68)) / 10^9)
        }
        spectre <- c(spectre, as.numeric(substr(as.character(fichier[304, ]), 9, 18)) / 10^9, as.numeric(substr(as.character(fichier[304, ]), 19, 28)) / 10^9, as.numeric(substr(as.character(fichier[304, ]), 29, 38)) / 10^9)
        
        Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][[paste0("Mesure_", j + l)]][["Spectre"]] <- data.frame(V1 = unite, V2 = spectre)
      }
    },
    warning = function(w) {
      print(i)
      print(w)
      print(j)
    }
  )
}
```

## Sauvegarde

```{r}
save(Base_De_Donnees_Spectres, file = "Base_De_Donnees_Spectres.RData")
```

# 2023

```{r}
# Labo_rajout <- "AE Dijon Circuit C retour"
# Labo <- Labo_rajout
# Spectro_rajout <- "FOSS 2500"
# Spectro <- Spectro_rajout

colonne_exclue <- c(1) # Tableau CSV uniquement
colonne_date <- 2 # NA si pas de date/heure
colonne_heure <- 3
ligne_debut <- 1

Annee = "Annee2023"

ech <- c(3, 63, 173, 187, 7, 15, 19, 23, 31, 35, 42, 64, 104, 108, 125, 127, 128, 129, 131, 133, 136, 151, 169, 176, 177, 184, 192, 193, 198, 199)
```

## Rajout d'un labo en 2023

```{r}
if (!(Labo_rajout %in% names(Base_De_Donnees_Spectres[[Annee]][["BGE7"]]))) {
  for (i in ech) {
    Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]] <- list.append(Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]], New_lab = list())
    names(Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]])[length(names(Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]]))] <- Labo_rajout
  }
}
```

## Rajout d'un Spectro en 2023

```{r}
if (!(Spectro_rajout %in% names(Base_De_Donnees_Spectres[[Annee]][["BGE7"]][[Labo]]))) {
  for (i in ech) {
    Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]] <- list.append(Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]], New_spectro = list(NULL))
    names(Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]])[length(Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]])] <- Spectro_rajout
    Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro_rajout]] <- list(Mesure_1 = list(Meta = data.frame(Circuit = Circuit, Nb_Rep = Nb_Rep, Type_Rep = Type_Rep, Resolution = Resolution, Unite_X = Unite_X, Abs_ou_Ref = Abs_ou_Ref, Date = Date, Heure = Heure, Temperature = Temperature, Hygrometrie = Hygrometrie), Spectre = NA))
  }
}
```

## Données non répétées 2023 (Fichier unique)

```{r}
debut_fichier <- "BGE23-"
fin_fichier <- "_C_fibre_optique.0.txt"

for (i in (ech)[- (1:4)]) {
  tryCatch(
    {
      
      if (i < 10) {
        nom_actuel <- paste0(debut_fichier, "00", i, fin_fichier) #paste0 plutôt que paste car il a un séparateur vide de base.
      } else if (i < 100) {
        nom_actuel <- paste0(debut_fichier, "0", i, fin_fichier)
      } else {
        nom_actuel <- paste0(debut_fichier, i, fin_fichier)
      }
      Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][["Mesure_1"]][["Spectre"]] <- read.csv(paste(chemin, nom_actuel, sep = ""), header = FALSE)
    },
    warning = function(w) {
      print(i)
    }
  )
}
```

## Données répétées 2023 (Fichier unique)

```{r}
for (i in (ech[1:4])) {
  tryCatch(
    {
      
      fin_fichier <- paste0(fin, 0, ".txt")
      if (i < 10) {
        nom_actuel <- paste0(debut_fichier, "00", i, fin_fichier) #paste0 plutôt que paste car il a un séparateur vide de base.
      } else if (i < 100) {
        nom_actuel <- paste0(debut_fichier, "0", i, fin_fichier)
      } else {
        nom_actuel <- paste0(debut_fichier, i, fin_fichier)
      }
      Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][[paste0("Mesure_", 1)]][["Spectre"]] <- read.csv(paste(chemin, nom_actuel, sep = ""), header = FALSE)
      Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][[paste0("Mesure_", 1)]][["Meta"]][["Type_Rep"]] <- 1
      
      for (j in 1:(nb_rep - 1)) {
        fin_fichier <- paste0(fin, j, ".txt")
        if (i < 10) {
          nom_actuel <- paste0(debut_fichier, "00", i, fin_fichier) #paste0 plutôt que paste car il a un séparateur vide de base.
        } else if (i < 100) {
          nom_actuel <- paste0(debut_fichier, "0", i, fin_fichier)
        } else {
          nom_actuel <- paste0(debut_fichier, i, fin_fichier)
        }
        Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][[paste0("Mesure_", j + 1)]][["Meta"]] <- data.frame(Circuit = Circuit, Nb_Rep = j + 1, Type_Rep = 1, Resolution = Resolution, Unite_X = Unite_X, Abs_ou_Ref = Abs_ou_Ref, Date = Date, Heure = Heure, Temperature = Temperature, Hygrometrie = Hygrometrie)
        Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][[paste0("Mesure_", j + 1)]][["Spectre"]] <- read.csv(paste(chemin, nom_actuel, sep = ""), header = FALSE)
      }
      
      # for (k in 0:4) {
      #   fin_fichier <- paste0(fin_bis, k, ".txt")
      #   if (i < 10) {
      #     nom_actuel <- paste0(debut_fichier, "00", i, fin_fichier) #paste0 plutôt que paste car il a un separateur vide de base.
      #   } else if (i < 100) {
      #     nom_actuel <- paste0(debut_fichier, "0", i, fin_fichier)
      #   } else {
      #     nom_actuel <- paste0(debut_fichier, i, fin_fichier)
      #   }
      #   Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][[paste0("Mesure_", k + 5)]][["Meta"]] <- data.frame(Circuit = Circuit, Nb_Rep = k + 5, Type_Rep = 2, Resolution = Resolution, Unite_X = Unite_X, Abs_ou_Ref = Abs_ou_Ref, Date = Date, Heure = Heure, Temperature = Temperature, Hygrometrie = Hygrometrie)
      #   Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][[paste0("Mesure_", k + 5)]][["Spectre"]] <- read.csv(paste(chemin, nom_actuel, sep = ""), header = FALSE)
      # }
    },
    warning = function(w) {
      print(i, j)
    }
  )
}
```

```{r}
save(Base_De_Donnees_Spectres, file = "Base_De_Donnees_Spectres.RData")
```

## Données non répétés 2023 (Tableau xlsx)

```{r}
chemin_fichier <- "Data (ancien)/Circuit C/C-AE-Dijon/DIJON Inspir C retour a Dijon depuis Montpellier.xlsx"
# chemin_fichier <- "Data (ancien)/Circuit B/B-AE-Dijon/DIJON Inspir B retour a Dijon depuis Gif.xlsx"
# chemin_fichier <- "Data (ancien)/Circuit A/A-AE-Dijon/circuits lots globaux/DIJON Inspir A retour a Dijon depuis Guadeloupe.xlsx"
# chemin_fichier <- "Data (ancien)/Circuit A/A-AE-Dijon/circuits lots globaux/DIJON Inspir A (Orléans)-Dijon-(Antilles).xlsx"

feuille <- "ds2500"
# feuille <- "6500"
debut <- "BGE23-"
# fin <- "A"
# fin <- "B"
fin <- "C"

Spectro <- Spectro_rajout

library(readxl)
tableau <- read_excel(chemin_fichier, sheet = feuille, col_names = TRUE)

colonne_premiere_mesure <- 5
colonne_ech <- 1

ech <- c(3, 63, 173, 187, 7, 15, 19, 23, 31, 35, 42, 64, 104, 108, 125, 127, 128, 129, 131, 133, 136, 151, 169, 176, 177, 184, 192, 193, 198, 199)

# for (i in (ech)) {
for (i in (ech)[- (1:4)]) {
# for (i in (ech)[- c((1:4), 9, 11, 15)]) {
  if (!is.na(colonne_date) && is.na(colonne_heure)) {
    tryCatch(
      {
        if (i < 10) {
          nom_actuel <- paste0(debut, "00", i, fin) # paste0 plutôt que paste car il a un séparateur vide de base.
        } else if (i < 100) {
          nom_actuel <- paste0(debut, "0", i, fin)
        } else {
          nom_actuel <- paste0(debut, i, fin)
        }
        y = which(nom_actuel == tableau[, colonne_ech])
      
        # résolution pas en nom de colonne
        Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][["Mesure_1"]][["Spectre"]] <- data.frame(V1 = t(t(as.numeric(tableau[ligne_debut - 1, colonne_premiere_mesure:length(tableau[ligne_debut - 1, ])]))), V2 = t(t(as.numeric(tableau[y, colonne_premiere_mesure:length(tableau[y, ])]))))
      
        # résolution en nom de colonne
        #Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][["Mesure_1"]][["Spectre"]] <- data.frame(V1 = t(t(as.numeric(colnames(tableau[y, colonne_premiere_mesure:length(tableau[y, ])])))), V2 = t(t(as.numeric(tableau[y, colonne_premiere_mesure:length(tableau[y, ])]))))
      
        
        Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][["Mesure_1"]][["Meta"]][["Date"]] <- format(tableau[[colonne_date]][[y]], format = "%D")
      
        Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][["Mesure_1"]][["Meta"]][["Heure"]] <- format(tableau[[colonne_date]][[y]], format = "%H:%M:%S")
      
      },
      warning = function(w) {
        print(i)
      }
    )
  } else {
    tryCatch(
      {
        if (i < 10) {
          nom_actuel <- paste0(debut, "00", i, fin) #paste0 plutôt que paste car il a un séparateur vide de base.
        } else if (i < 100) {
          nom_actuel <- paste0(debut, "0", i, fin)
        } else {
          nom_actuel <- paste0(debut, i, fin)
        }
        y = which(nom_actuel == tableau[, colonne_ech])
      
        # résolution pas en nom de colonne
        # Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][["Mesure_1"]][["Spectre"]] <- data.frame(V1 = t(t(as.numeric(tableau[ligne_debut - 1, colonne_premiere_mesure:length(tableau[ligne_debut - 1, ])]))), V2 = t(t(as.numeric(tableau[y, colonne_premiere_mesure:length(tableau[y, ])]))))
        
        
        # résolution en nom de colonne
        Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][["Mesure_1"]][["Spectre"]] <- data.frame(V1 = t(t(as.numeric(colnames(tableau[y, colonne_premiere_mesure:length(tableau[y, ])])))), V2 = t(t(as.numeric(tableau[y, colonne_premiere_mesure:length(tableau[y, ])]))))
      
        Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][["Mesure_1"]][["Meta"]][["Date"]] <- ifelse(is.na(colonne_date), Date, format(tableau[[colonne_date]][[y]], format = "%d/%m/%Y"))
      
        Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][["Mesure_1"]][["Meta"]][["Heure"]] <- ifelse(is.na(colonne_heure), Heure, format(tableau[[colonne_heure]][[y]], format = "%H:%M:%S"))
        
      },
      warning = function(w) {
        print(i)
      }
    )
  }
}

```

## Données répétés 2023 (Tableau xlsx)

```{r}
# chemin_fichier <- "Data (ancien)/Circuit A/A-AE-Dijon/circuits lots globaux/DIJON Inspir export.xlsx"
# feuille <- "6500"
debut <- "BGE23-"
# fin <- "A"
# fin <- "B"
fin <- "C"

l <- 0 # 0 par défaut, décalage de toutes les mesures à répéter si on en a déjà précédemment (dans non répétés) (Ex: PEGASE St Gilles)

nb_rep <- 15
k <- 0 # 0 par défaut, décalage pour changer le type de répétition
typ_rep <- 2

colonne_premiere_mesure <- 5
colonne_ech <- 1

Spectro <- Spectro_rajout

library(readxl)
# tableau <- read_excel(chemin_fichier, sheet = feuille, col_names = TRUE)


# for (i in ech) {
for (i in (ech[1:4])) {
# for (i in (ech[c((1:4), 9, 11, 15)])) {
  if (!is.na(colonne_date) && is.na(colonne_heure)) {
    tryCatch(
      {
        if (i < 10) {
          nom_actuel <- paste0(debut, "00", i, fin) #paste0 plutôt que paste car il a un séparateur vide de base.
        } else if (i < 100) {
          nom_actuel <- paste0(debut, "0", i, fin)
        } else {
          nom_actuel <- paste0(debut, i, fin)
        }
        y = which(nom_actuel == tableau[, colonne_ech])
      
        Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][[paste0("Mesure_", (1 + l + k))]][["Meta"]] <- data.frame(Circuit = Circuit, Nb_Rep = 1, Type_Rep = typ_rep, Resolution = Resolution, Unite_X = Unite_X, Abs_ou_Ref = Abs_ou_Ref, Date = format(tableau[[colonne_date]][[y[1 + k]]], format = "%D"), Heure = format(tableau[[colonne_date]][[y[1 + k]]], format = "%H:%M:%S"), Temperature = Temperature, Hygrometrie = Hygrometrie)
      
        # résolution en nom de colonne
        # Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][[paste0("Mesure_", (1 + l + k))]][["Spectre"]] <- data.frame(V1 = t(t(as.numeric(colnames(tableau[y[1 + k], colonne_premiere_mesure:length(tableau[y[1 + k], ])])))), V2 = t(t(as.numeric(tableau[y[1 + k], colonne_premiere_mesure:length(tableau[y[1 + k], ])]))))
      
        # résolution pas en nom de colonne
        Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][[paste0("Mesure_", (1 + l + k))]][["Spectre"]] <- data.frame(V1 = t(t(as.numeric(tableau[ligne_debut - 1, colonne_premiere_mesure:length(tableau[ligne_debut - 1, ])]))), V2 = t(t(as.numeric(tableau[y[1 + k], colonne_premiere_mesure:length(tableau[y[1 + k], ])]))))
      
        for (j in (2 + k):(nb_rep + k)) {
          if (i < 10) {
            nom_actuel <- paste0(debut, "00", i, fin) #paste0 plutôt que paste car il a un séparateur vide de base.
          } else if (i < 100) {
            nom_actuel <- paste0(debut, "0", i, fin)
          } else {
            nom_actuel <- paste0(debut, i, fin)
          }
          
          Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][[paste0("Mesure_", (j + l))]][["Meta"]] <- data.frame(Circuit = Circuit, Nb_Rep = (j - k), Type_Rep = typ_rep, Resolution = Resolution, Unite_X = Unite_X, Abs_ou_Ref = Abs_ou_Ref, Date = format(tableau$Horodatage[y[j]], format = "%D"), Heure = format(tableau$Horodatage[y[j]], format = "%H:%M:%S"), Temperature = Temperature, Hygrometrie = Hygrometrie)
          
          # longueur en nom de colonne
          # Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][[paste0("Mesure_", j + l)]][["Spectre"]] <- data.frame(V1 = t(t(as.numeric(colnames(tableau[y[j], colonne_premiere_mesure:length(tableau[y[j], ])])))), V2 = t(t(as.numeric(tableau[y[j], colonne_premiere_mesure:length(tableau[y[j], ])]))))
          
          # longueur pas en nom de colonne
          Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][[paste0("Mesure_", j + l)]][["Spectre"]] <- data.frame(V1 = t(t(as.numeric(tableau[ligne_debut - 1, colonne_premiere_mesure:length(tableau[ligne_debut - 1, ])]))), V2 = t(t(as.numeric(tableau[y[j], colonne_premiere_mesure:length(tableau[y[j], ])]))))
      }
    },
    warning = function(w) {
      print(i)
      print(j)
      print(w)
    },
    error = function(e) {
      print(i)
      print(j)
      print(e)
    }
  )
  
  } else {
    
    tryCatch(
      {
        if (i < 10) {
          nom_actuel <- paste0(debut, "00", i, fin) #paste0 plutôt que paste car il a un séparateur vide de base.
        } else if (i < 100) {
          nom_actuel <- paste0(debut, "0", i, fin)
        } else {
          nom_actuel <- paste0(debut, i, fin)
        }
        y = which(nom_actuel == tableau[, colonne_ech])
      
        Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][[paste0("Mesure_", (1 + l + k))]][["Meta"]] <- data.frame(Circuit = Circuit, Nb_Rep = 1, Type_Rep = typ_rep, Resolution = Resolution, Unite_X = Unite_X, Abs_ou_Ref = Abs_ou_Ref, Date = ifelse(is.na(colonne_date), Date, format(tableau[[colonne_date]][[y[1 + k]]], format = "%d/%m/%Y")), Heure = ifelse(is.na(colonne_heure), Heure, format(tableau[[colonne_heure]][[y[1 + k]]], format = "%H:%M:%S")), Temperature = Temperature, Hygrometrie = Hygrometrie)
        
        # Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][[paste0("Mesure_", (1 + l + k))]][["Meta"]] <- data.frame(Circuit = Circuit, Nb_Rep = 1, Type_Rep = typ_rep, Resolution = Resolution, Unite_X = Unite_X, Abs_ou_Ref = Abs_ou_Ref, Date = Date, Heure = ifelse(is.na(colonne_heure), Heure, tableau[[colonne_heure]][[y[1 + k]]]), Temperature = Temperature, Hygrometrie = Hygrometrie)
      
        # résolution en nom de colonne
        Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][[paste0("Mesure_", (1 + l + k))]][["Spectre"]] <- data.frame(V1 = t(t(as.numeric(colnames(tableau[y[1 + k], colonne_premiere_mesure:length(tableau[y[1 + k], ])])))), V2 = t(t(as.numeric(tableau[y[1 + k], colonne_premiere_mesure:length(tableau[y[1 + k], ])]))))
      
        # résolution pas en nom de colonne
        # Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][[paste0("Mesure_", (1 + l + k))]][["Spectre"]] <- data.frame(V1 = t(t(as.numeric(tableau[ligne_debut - 1, colonne_premiere_mesure:length(tableau[ligne_debut - 1, ])]))), V2 = t(t(as.numeric(tableau[y[1 + k], colonne_premiere_mesure:length(tableau[y[1 + k], ])])))) 
      
        for (j in (2 + k):(nb_rep + k)) {
          if (i < 10) {
            nom_actuel <- paste0(debut, "00", i, fin) #paste0 plutôt que paste car il a un séparateur vide de base.
          } else if (i < 100) {
            nom_actuel <- paste0(debut, "0", i, fin)
          } else {
            nom_actuel <- paste0(debut, i, fin)
          }
          
          Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][[paste0("Mesure_", (j + l))]][["Meta"]] <- data.frame(Circuit = Circuit, Nb_Rep = (j - k), Type_Rep = typ_rep, Resolution = Resolution, Unite_X = Unite_X, Abs_ou_Ref = Abs_ou_Ref, Date = ifelse(is.na(colonne_date), Date, format(tableau[[colonne_date]][[y[1 + k]]], format = "%d/%m/%Y")), Heure = ifelse(is.na(colonne_heure), Heure, format(tableau[[colonne_heure]][[y[1 + k]]], format = "%H:%M:%S")), Temperature = Temperature, Hygrometrie = Hygrometrie)
          
          # Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][[paste0("Mesure_", (j + l))]][["Meta"]] <- data.frame(Circuit = Circuit, Nb_Rep = (j - k), Type_Rep = typ_rep, Resolution = Resolution, Unite_X = Unite_X, Abs_ou_Ref = Abs_ou_Ref, Date = Date, Heure = ifelse(is.na(colonne_heure), Heure, tableau[[colonne_heure]][[y[1 + k]]]), Temperature = Temperature, Hygrometrie = Hygrometrie)
          
          # résolution en nom de colonne
          Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][[paste0("Mesure_", j + l)]][["Spectre"]] <- data.frame(V1 = t(t(as.numeric(colnames(tableau[y[j], colonne_premiere_mesure:length(tableau[y[j], ])])))), V2 = t(t(as.numeric(tableau[y[j], colonne_premiere_mesure:length(tableau[y[j], ])]))))
          
          # résolution pas en nom de colonne
          # Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][[paste0("Mesure_", j + l)]][["Spectre"]] <- data.frame(V1 = t(t(as.numeric(tableau[ligne_debut - 1, colonne_premiere_mesure:length(tableau[ligne_debut - 1, ])]))), V2 = t(t(as.numeric(tableau[y[j], colonne_premiere_mesure:length(tableau[y[j], ])]))))
      }
    },
    warning = function(w) {
      print(i)
      print(j)
      print(w)
    },
    error = function(e) {
      print(i)
      print(j)
      print(e)
    }
  )
  }
}
```

## Données non répétés 2023 (Tableau csv)

```{r}
chemin_fichier <- "Data/Circuit C/C-BIOGECO-Bordeaux/MPA1_Coupelle.csv"
sep <- ";"
debut <- "BGE23-"
fin <- ""

# tableau <- read.csv(chemin_fichier, header = FALSE, sep = sep)

suppressWarnings(unite <- as.vector(unlist(lapply(tableau, `[[`, ligne_debut), use.names = FALSE), 'numeric')[- colonne_exclue])

for (i in (ech)[- (1:4)]) {
# for (i in ech) {
  tryCatch(
    {
      if (i < 10) {
        nom_actuel <- paste0(debut, "00", i, fin) #paste0 plutôt que paste car il a un séparateur vide de base.
      } else if (i < 100) {
        nom_actuel <- paste0(debut, "0", i, fin)
      } else {
        nom_actuel <- paste0(debut, i, fin)
      }
      y = which(nom_actuel == tableau[, 1])
      
      Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][["Mesure_1"]][["Spectre"]] <- data.frame(V1 = unite, V2 = as.vector(unlist(lapply(tableau, `[[`, y), use.names = FALSE)[- colonne_exclue], 'numeric'))
      
      if (!is.na(colonne_date)) {
        Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][["Mesure_1"]][["Meta"]][["Date"]] <- tableau[[colonne_date]][[y]]
      }
      
      if (!is.na(colonne_heure)) {
        Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][["Mesure_1"]][["Meta"]][["Heure"]] <- tableau[[colonne_heure]][[y]]
      }
    },
    warning = function(w) {
      print(i)
    },
    error = function(e) {
      print(i)
    }
  )
}

```

## Données répétés 2023 (Tableau csv)

```{r}
chemin_fichier <- "Data/Circuit C/C-BIOGECO-Bordeaux/MPA1_Coupelle.csv"
sep <- ";"
debut <- "BGE23-"
fin <- ""

colonne_exclue <- c(1, 2, 3, 4, 5)
colonne_date <- 3 # NA si pas de date/heure
colonne_heure <- 4
ligne_debut <- 1

l <- 0 # 0 par défaut, décalage de toutes les mesures à répéter si on en a déjà précedemment, dans un autre tableau (dans non répétés) (Ex: PEGASE St Gilles)

nb_rep <- 5
k <- 1 # 0 par défaut, décalage pour changer le type de répétition
typ_rep <- 2


# tableau <- read.csv(chemin_fichier, header = FALSE, sep = sep)

# suppressWarnings(unite <- as.vector(unlist(lapply(tableau, `[[`, ligne_debut), use.names = FALSE), 'numeric')[- colonne_exclue])

# for (i in ech) {
for (i in (ech[1:4])) {
  tryCatch(
    {
      if (i < 10) {
        nom_actuel <- paste0(debut, "00", i, fin) #paste0 plutôt que paste car il a un séparateur vide de base.
      } else if (i < 100) {
        nom_actuel <- paste0(debut, "0", i, fin)
      } else {
        nom_actuel <- paste0(debut, i, fin)
      }
      y = which(nom_actuel == tableau[, 1])
      
      Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][[paste0("Mesure_", (1 + l + k))]][["Meta"]] <- data.frame(Circuit = Circuit, Nb_Rep = 1, Type_Rep = typ_rep, Resolution = Resolution, Unite_X = Unite_X, Abs_ou_Ref = Abs_ou_Ref, Date = ifelse(is.na(colonne_date), Date, tableau[[colonne_date]][[y[1 + k]]]), Heure = ifelse(is.na(colonne_heure), Heure, tableau[[colonne_heure]][[y[1 + k]]]), Temperature = Temperature, Hygrometrie = Hygrometrie)
      
      Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][[paste0("Mesure_", (1 + l + k))]][["Spectre"]] <- data.frame(V1 = unite, V2 = as.vector(unlist(lapply(tableau, `[[`, y[1 + k]), use.names = FALSE)[- colonne_exclue], 'numeric'))
      
      if (nb_rep != 1){
        for (j in (2 + k):(nb_rep + k)) {
          Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][[paste0("Mesure_", (j + l))]][["Meta"]] <- data.frame(Circuit = Circuit, Nb_Rep = (j - k), Type_Rep = typ_rep, Resolution = Resolution, Unite_X = Unite_X, Abs_ou_Ref = Abs_ou_Ref, Date = ifelse(is.na(colonne_date), Date, tableau[[colonne_date]][[y[j]]]), Heure = ifelse(is.na(colonne_heure), Heure, tableau[[colonne_heure]][[y[j]]]), Temperature = Temperature, Hygrometrie = Hygrometrie)
        
        Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][[paste0("Mesure_", j + l)]][["Spectre"]] <- data.frame(V1 = unite, V2 = as.vector(unlist(lapply(tableau, `[[`, y[j]), use.names = FALSE)[- colonne_exclue], 'numeric'))
        }
      }
    },
    warning = function(w) {
      print(i)
      print(j)
      print(w)
    },
    error = function(e) {
      print(i)
      print(j)
      print(e)
    }
  )
}
```

```{r}
save(Base_De_Donnees_Spectres, file = "Base_De_Donnees_Spectres.RData")
```

## Données non répétées 2023 (Fichier unique dans un tableau)

```{r}
ech <- c(3, 23, 173, 187, 7, 15, 19, 31, 35, 42, 63, 64, 104, 108, 125, 127, 128, 129, 131, 133, 136, 151, 169, 176, 177, 184, 192, 193, 198, 199)

chemin <- "Data/Circuit B/B-IJPB-Versailles/INTERLABO24_240605/INTERLABO24_240605/IJPB_Versailles_MODELE 2etuve.xlsx"

debut <- "BGE23-"
fin <- "_"

colonne_ech <- 2
colonne_fichier <- 7

Spectro = Spectro_rajout

library(readxl)
tableau <- read_excel(chemin, sheet = "DS2500", col_names = FALSE)

for (i in (ech)[- (1:4)]) {
  tryCatch(
    {
      if (i < 10) {
        nom_actuel <- paste0(debut, "00", i, fin) #paste0 plutôt que paste car il a un séparateur vide de base.
      } else if (i < 100) {
        nom_actuel <- paste0(debut, "0", i, fin)
      } else {
        nom_actuel <- paste0(debut, i, fin)
      }
      y = which(nom_actuel == tableau[, colonne_ech])
      
      fichier <- read_csv(paste0("Data/Circuit B/B-IJPB-Versailles/INTERLABO24_240605/INTERLABO24_240605/", tableau[y, colonne_fichier]), show_col_types = FALSE)
      
      Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][["Mesure_1"]][["Meta"]][["Date"]] <- substr(as.character(fichier[5, ]), 12, nchar(as.character(fichier[5, ])))
      
      Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][["Mesure_1"]][["Meta"]][["Heure"]] <- substr(as.character(fichier[6, ]), 8, nchar(as.character(fichier[6, ])))
      
      # if (i == 192) {
      #   unite <- c(as.numeric(substr(as.character(fichier[45, ]), 1, 8)))
      #   prochain <- as.numeric(substr(as.character(fichier[46, ]), 1, 8))
      #   dif <- (prochain - unite[1]) / 6
      #   unite <- c(unite, prochain - 5 * dif, prochain - 4 * dif, prochain - 3 * dif, prochain - 2 * dif, prochain - dif, prochain)
      #   for (j in 2:222) {
      #     prochain <- as.numeric(substr(as.character(fichier[j + 45, ]), 1, 8))
      #     dif <- (prochain - unite[(j - 2) * 7 + 7]) / 7
      #     unite <- c(unite, prochain - 6 * dif, prochain - 5 * dif, prochain - 4 * dif, prochain - 3 * dif, prochain - 2 * dif, prochain - dif, prochain)
      #   }
      #   dif <- (as.numeric(substr(as.character(fichier[35, ]), 8, nchar(as.character(fichier[35, ])))) - tail(unite, 1)) / 3
      #   unite <- c(unite, prochain + dif, prochain + 2 * dif, as.numeric(substr(as.character(fichier[35, ]), 8, nchar(as.character(fichier[35, ])))))
      #   
      #   spectre <- c(as.numeric(substr(as.character(fichier[45, ]), 9, 18)) / 10^8, as.numeric(substr(as.character(fichier[45, ]), 19, 28)) / 10^8, as.numeric(substr(as.character(fichier[45, ]), 29, 38)) / 10^8, as.numeric(substr(as.character(fichier[45, ]), 39, 48)) / 10^8, as.numeric(substr(as.character(fichier[45, ]), 49, 58)) / 10^8, as.numeric(substr(as.character(fichier[45, ]), 59, 68)) / 10^8)
      #   spectre <- c(spectre, as.numeric(substr(as.character(fichier[46, ]), 10, 18)) / 10^8, as.numeric(substr(as.character(fichier[46, ]), 20, 28)) / 10^8, as.numeric(substr(as.character(fichier[46, ]), 30, 37)) / 10^8, as.numeric(substr(as.character(fichier[46, ]), 39, 46)) / 10^8, as.numeric(substr(as.character(fichier[46, ]), 48, 55)) / 10^8, as.numeric(substr(as.character(fichier[46, ]), 57, 64)) / 10^8, as.numeric(substr(as.character(fichier[46, ]), 66, 73)) / 10^8)
      #   for (k in 2:221) {
      #     spectre <- c(spectre, as.numeric(substr(as.character(fichier[k + 45, ]), 10, 17)) / 10^8, as.numeric(substr(as.character(fichier[k + 45, ]), 19, 26)) / 10^8, as.numeric(substr(as.character(fichier[k + 45, ]), 28, 35)) / 10^8, as.numeric(substr(as.character(fichier[k + 45, ]), 37, 44)) / 10^8, as.numeric(substr(as.character(fichier[k + 45, ]), 46, 53)) / 10^8, as.numeric(substr(as.character(fichier[k + 45, ]), 55, 62)) / 10^8, as.numeric(substr(as.character(fichier[k + 45, ]), 64, 71)) / 10^8)
      #   }
      #   spectre <- c(spectre, as.numeric(substr(as.character(fichier[267, ]), 10, 17)) / 10^8, as.numeric(substr(as.character(fichier[267, ]), 19, 26)) / 10^8, as.numeric(substr(as.character(fichier[267, ]), 28, 35)) / 10^8, as.numeric(substr(as.character(fichier[267, ]), 37, 44)) / 10^8)
      #   
       # } else {
        unite <- c(as.numeric(substr(as.character(fichier[45, ]), 1, 8)))
        
        for (j in 1:259) {
          prochain <- as.numeric(substr(as.character(fichier[j + 45, ]), 1, 8))
          dif <- (prochain - unite[(j - 1) * 6 + 1]) / 6
          unite <- c(unite, prochain - 5 * dif, prochain - 4 * dif, prochain - 3 * dif, prochain - 2 * dif, prochain - dif, prochain)
        }
        
        unite <- c(unite, prochain + (as.numeric(substr(as.character(fichier[35, ]), 8, nchar(as.character(fichier[35, ])))) - prochain) / 2, as.numeric(substr(as.character(fichier[35, ]), 8, nchar(as.character(fichier[35, ])))))
        
        spectre <- c(as.numeric(substr(as.character(fichier[45, ]), 9, 18)) / 10^9, as.numeric(substr(as.character(fichier[45, ]), 19, 28)) / 10^9, as.numeric(substr(as.character(fichier[45, ]), 29, 38)) / 10^9, as.numeric(substr(as.character(fichier[45, ]), 39, 48)) / 10^9, as.numeric(substr(as.character(fichier[45, ]), 49, 58)) / 10^9, as.numeric(substr(as.character(fichier[45, ]), 59, 68)) / 10^9)
        
        for (k in 1:258) {
          spectre <- c(spectre, as.numeric(substr(as.character(fichier[k + 45, ]), 9, 18)) / 10^9, as.numeric(substr(as.character(fichier[k + 45, ]), 19, 28)) / 10^9, as.numeric(substr(as.character(fichier[k + 45, ]), 29, 38)) / 10^9, as.numeric(substr(as.character(fichier[k + 45, ]), 39, 48)) / 10^9, as.numeric(substr(as.character(fichier[k + 45, ]), 49, 58)) / 10^9, as.numeric(substr(as.character(fichier[k + 45, ]), 59, 68)) / 10^9)
        }
        
        spectre <- c(spectre, as.numeric(substr(as.character(fichier[304, ]), 9, 18)) / 10^9, as.numeric(substr(as.character(fichier[304, ]), 19, 28)) / 10^9, as.numeric(substr(as.character(fichier[304, ]), 29, 38)) / 10^9)
      # }
      
      Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][["Mesure_1"]][["Spectre"]] <- data.frame(V1 = unite, V2 = spectre)
        
    },
    warning = function(w) {
      print(i)
    }
  )
}
```

## Données répétées 2023 (Fichier unique dans un tableau)

```{r}
l <- 0 # 0 par défaut, décalage de toutes les mesures à répéter si on en a déjà précédemment (dans non répétés) (Ex: PEGASE St Gilles)

nb_rep <- 2
k <- 5 # 0 par défaut, décalage pour changer le type de répétition
typ_rep <- 3

for (i in (ech[1:4])) {
  tryCatch(
    {
      if (i < 10) {
        nom_actuel <- paste0(debut, "00", i, fin) #paste0 plutôt que paste car il a un séparateur vide de base.
      } else if (i < 100) {
        nom_actuel <- paste0(debut, "0", i, fin)
      } else {
        nom_actuel <- paste0(debut, i, fin)
      }
      y = which(nom_actuel == tableau[, colonne_ech])
      
      fichier <- read_csv(paste0("Data/Circuit B/B-IJPB-Versailles/INTERLABO24_240605/INTERLABO24_240605/", tableau[y[1], colonne_fichier]), show_col_types = FALSE)
      
      Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][[paste0("Mesure_", (1 + l + k))]][["Meta"]] <- data.frame(Circuit = Circuit, Nb_Rep = 1, Type_Rep = typ_rep, Resolution = Resolution, Unite_X = Unite_X, Abs_ou_Ref = Abs_ou_Ref, Date = substr(as.character(fichier[5, ]), 12, nchar(as.character(fichier[5, ]))), Heure = substr(as.character(fichier[6, ]), 8, nchar(as.character(fichier[6, ]))), Temperature = Temperature, Hygrometrie = Hygrometrie)
        
      unite <- c(as.numeric(substr(as.character(fichier[45, ]), 1, 8)))
      
      for (q in 1:259) {
        prochain <- as.numeric(substr(as.character(fichier[q + 45, ]), 1, 8))
        dif <- (prochain - unite[(q - 1) * 6 + 1]) / 6
        unite <- c(unite, prochain - 5 * dif, prochain - 4 * dif, prochain - 3 * dif, prochain - 2 * dif, prochain - dif, prochain)
      }
      unite <- c(unite, prochain + (as.numeric(substr(as.character(fichier[35, ]), 8, nchar(as.character(fichier[35, ])))) - prochain) / 2, as.numeric(substr(as.character(fichier[35, ]), 8, nchar(as.character(fichier[35, ])))))
        
      spectre <- c(as.numeric(substr(as.character(fichier[45, ]), 9, 18)) / 10^9, as.numeric(substr(as.character(fichier[45, ]), 19, 28)) / 10^9, as.numeric(substr(as.character(fichier[45, ]), 29, 38)) / 10^9, as.numeric(substr(as.character(fichier[45, ]), 39, 48)) / 10^9, as.numeric(substr(as.character(fichier[45, ]), 49, 58)) / 10^9, as.numeric(substr(as.character(fichier[45, ]), 59, 68)) / 10^9)
      
      for (f in 1:258) {
        spectre <- c(spectre, as.numeric(substr(as.character(fichier[f + 45, ]), 9, 18)) / 10^9, as.numeric(substr(as.character(fichier[f + 45, ]), 19, 28)) / 10^9, as.numeric(substr(as.character(fichier[f + 45, ]), 29, 38)) / 10^9, as.numeric(substr(as.character(fichier[f + 45, ]), 39, 48)) / 10^9, as.numeric(substr(as.character(fichier[f + 45, ]), 49, 58)) / 10^9, as.numeric(substr(as.character(fichier[f + 45, ]), 59, 68)) / 10^9)
      }
      spectre <- c(spectre, as.numeric(substr(as.character(fichier[304, ]), 9, 18)) / 10^9, as.numeric(substr(as.character(fichier[304, ]), 19, 28)) / 10^9, as.numeric(substr(as.character(fichier[304, ]), 29, 38)) / 10^9)
      
      Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][[paste0("Mesure_", (1 + l + k))]][["Spectre"]] <- data.frame(V1 = unite, V2 = spectre)
      
      for (j in (2 + k):(nb_rep + k)) {
        
        fichier <- read_csv(paste0("Data/Circuit B/B-IJPB-Versailles/INTERLABO24_240605/INTERLABO24_240605/", tableau[y[j], colonne_fichier]), show_col_types = FALSE)
        
        Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][[paste0("Mesure_", (j + l))]][["Meta"]] <- data.frame(Circuit = Circuit, Nb_Rep = (j - k), Type_Rep = typ_rep, Resolution = Resolution, Unite_X = Unite_X, Abs_ou_Ref = Abs_ou_Ref, Date = substr(as.character(fichier[5, ]), 12, nchar(as.character(fichier[5, ]))), Heure = substr(as.character(fichier[6, ]), 8, nchar(as.character(fichier[6, ]))), Temperature = Temperature, Hygrometrie = Hygrometrie)
      
        unite <- c(as.numeric(substr(as.character(fichier[45, ]), 1, 8)))
        
        for (u in 1:259) {
          prochain <- as.numeric(substr(as.character(fichier[u + 45, ]), 1, 8))
          dif <- (prochain - unite[(u - 1) * 6 + 1]) / 6
          unite <- c(unite, prochain - 5 * dif, prochain - 4 * dif, prochain - 3 * dif, prochain - 2 * dif, prochain - dif, prochain)
        }
        unite <- c(unite, prochain + (as.numeric(substr(as.character(fichier[35, ]), 8, nchar(as.character(fichier[35, ])))) - prochain) / 2, as.numeric(substr(as.character(fichier[35, ]), 8, nchar(as.character(fichier[35, ])))))
        
        spectre <- c(as.numeric(substr(as.character(fichier[45, ]), 9, 18)) / 10^9, as.numeric(substr(as.character(fichier[45, ]), 19, 28)) / 10^9, as.numeric(substr(as.character(fichier[45, ]), 29, 38)) / 10^9, as.numeric(substr(as.character(fichier[45, ]), 39, 48)) / 10^9, as.numeric(substr(as.character(fichier[45, ]), 49, 58)) / 10^9, as.numeric(substr(as.character(fichier[45, ]), 59, 68)) / 10^9)
        
        for (o in 1:258) {
          spectre <- c(spectre, as.numeric(substr(as.character(fichier[o + 45, ]), 9, 18)) / 10^9, as.numeric(substr(as.character(fichier[o + 45, ]), 19, 28)) / 10^9, as.numeric(substr(as.character(fichier[o + 45, ]), 29, 38)) / 10^9, as.numeric(substr(as.character(fichier[o + 45, ]), 39, 48)) / 10^9, as.numeric(substr(as.character(fichier[o + 45, ]), 49, 58)) / 10^9, as.numeric(substr(as.character(fichier[o + 45, ]), 59, 68)) / 10^9)
        }
        spectre <- c(spectre, as.numeric(substr(as.character(fichier[304, ]), 9, 18)) / 10^9, as.numeric(substr(as.character(fichier[304, ]), 19, 28)) / 10^9, as.numeric(substr(as.character(fichier[304, ]), 29, 38)) / 10^9)
        
        Base_De_Donnees_Spectres[[Annee]][[paste0("BGE", i)]][[Labo]][[Spectro]][[paste0("Mesure_", j + l)]][["Spectre"]] <- data.frame(V1 = unite, V2 = spectre)
      }
    },
    warning = function(w) {
      print(i)
      print(w)
      print(j)
    }
  )
}
```

```{r}
plot(0, type = "l", main = "Comparaison entre deux méthodes d'aquisitions de spectres de l'échantillon BGE003 (2023) avec répétition (BIOGECO Bordeaux, MPA1)", xlab = "cm-1", ylab = "Reflectance", ylim = c(0, 2), xlim = c(3650, 12650))
for (i in 1:9) {
  lines(Base_De_Donnees_Spectres$Annee2023$BGE3$BIOGECO_Bordeaux$MPA1[[i]][[2]], type = "l", col = i)
}
text(12000, 0.5, "Coupelles")

for (i in 1:5) {
lines(x = Base_De_Donnees_Spectres$Annee2023$BGE3$BIOGECO_Bordeaux$MPA1_Fibre[[i]][[2]][[1]], y = Base_De_Donnees_Spectres$Annee2023$BGE3$BIOGECO_Bordeaux$MPA1_Fibre[[i]][[2]][[2]], type = "l", col = i + 9)
}
text(6000, 0.2, "Fibre", col = "red") 

```

```{r}
plot(0, type = "l", main = "Spectres de l'échantillon BGE118 (2022), répétés 18, 10 et 11 fois (PEGASE St Gilles, IGEPP Rennes et URP3F Lusignan respectivement, MPA)", xlab = "cm-1", ylab = "Reflectance", ylim = c(0, 2), xlim = c(3650, 12550))
for (i in 1:18) {
  lines(Base_De_Donnees_Spectres$Annee2022$BGE118$PEGASE_St_Gilles$MPA2787[[i]][[2]], type = "l", col = i)
}
text(5000, 0.1, "PEGASE St Gilles")

for (i in 1:10) {
  lines(Base_De_Donnees_Spectres$Annee2022$BGE118$IGEPP_Rennes$MPA[[i]][[2]], type = "l", col = i + 29)
}
text(11000, 0, "IGEPP Rennes")

for (i in 1:11) {
  lines(Base_De_Donnees_Spectres$Annee2022$BGE118$URP3F_Lusignan$MPA[[i]][[2]], type = "l", col = i + 18)
}
text(11000, 0.5, "URP3F Lusignan")
```

# Retrait données

```{r}
for (i in (1:180)) {
  Base_De_Donnees_Spectres$Annee2022[[i]][[9]][[2]] <- NULL
}
```

# Modification données

```{r}
for (ann in (1:2)) {
  for (ech in 1:length(Base_De_Donnees_Spectres[[ann]])) {
    # for (lab in 1:length(Base_De_Donnees_Spectres[[ann]][[ech]])) {
    for (lab in 14) {
      # for (spec in 1:length(Base_De_Donnees_Spectres[[ann]][[ech]][[lab]])) {
      for (spec in 2) {
        for (mesure in 1:length(Base_De_Donnees_Spectres[[ann]][[ech]][[lab]][[spec]])) {
          Base_De_Donnees_Spectres[[ann]][[ech]][[lab]][[spec]][[mesure]][[1]][[4]] <- 0.5
        }
      }
    }
  }
}

Base_De_Donnees_Spectres[[a]][[i]][[lab]][[spectro]][[mesure]][[1]][[4]]
```

```{r}
for (ann in (1:2)) {
  for (ech in 1:length(Base_De_Donnees_Spectres[[ann]])) {
    # for (lab in 1:length(Base_De_Donnees_Spectres[[ann]][[ech]])) {
    for (lab in 4) {
      for (spec in 1) {
        temp <- Base_De_Donnees_Spectres[[ann]][[ech]][[lab]][[spec]]
        Base_De_Donnees_Spectres[[ann]][[ech]][[lab]][["Thermo Antaris II"]] <- list.append(temp)
        Base_De_Donnees_Spectres[[ann]][[ech]][[lab]][[1]] <- NULL
      }
    }
  }
}
```

